<script lang="ts">
	import type { Task } from '$lib/task/utils.js';

	import Select from '$lib/components/form/select/Select.svelte';
	import SelectItem from '$lib/components/form/select/select-item/SelectItem.svelte';

	import {
		type ReportInterval,
		ReportIntervals,
		getDataSet,
		getUncompletedTasksByDate,
	} from './service';
	import LineChart from './line-chart/LineChart.svelte';

	export let tasks: Task[];

	let interval: ReportInterval = ReportIntervals.DAY;

	$: intervalKey =
		Object.keys(ReportIntervals)
			.find((key) => ReportIntervals[key] === interval)
			?.toLowerCase() || 'day';

	$: uncompletedTasksByDate = getUncompletedTasksByDate(tasks, interval);

	$: dataset = getDataSet(uncompletedTasksByDate, interval);

	// $: dataset = [
	// 	[
	// 		'31.01.24',
	// 		'01.02.24',
	// 		'02.02.24',
	// 		'03.02.24',
	// 		'04.02.24',
	// 		'05.02.24',
	// 		'06.02.24',
	// 		'07.02.24',
	// 		'08.02.24',
	// 		'09.02.24',
	// 		'10.02.24',
	// 		'11.02.24',
	// 		'12.02.24',
	// 		'13.02.24',
	// 		'14.02.24',
	// 		'15.02.24',
	// 		'16.02.24',
	// 		'17.02.24',
	// 		'18.02.24',
	// 		'19.02.24',
	// 		'20.02.24',
	// 		'21.02.24',
	// 		'22.02.24',
	// 		'23.02.24',
	// 		'24.02.24',
	// 		'25.02.24',
	// 		'26.02.24',
	// 		'27.02.24',
	// 		'28.02.24',
	// 		'29.02.24',
	// 		'01.03.24',
	// 		'02.03.24',
	// 		'03.03.24',
	// 		'04.03.24',
	// 		'05.03.24',
	// 		'06.03.24',
	// 		'12.03.24',
	// 		'13.03.24',
	// 		'14.03.24',
	// 		'15.03.24',
	// 		'16.03.24',
	// 		'17.03.24',
	// 		'18.03.24',
	// 		'19.03.24',
	// 		'20.03.24',
	// 		'21.03.24',
	// 		'22.03.24',
	// 		'23.03.24',
	// 		'24.03.24',
	// 		'25.03.24',
	// 		'26.03.24',
	// 		'27.03.24',
	// 		'28.03.24',
	// 		'29.03.24',
	// 		'30.03.24',
	// 		'31.03.24',
	// 		'01.04.24',
	// 		'02.04.24',
	// 		'03.04.24',
	// 		'04.04.24',
	// 		'05.04.24',
	// 		'06.04.24',
	// 		'07.04.24',
	// 		'08.04.24',
	// 		'09.04.24',
	// 		'10.04.24',
	// 		'11.04.24',
	// 		'12.04.24',
	// 		'13.04.24',
	// 		'14.04.24',
	// 		'15.04.24',
	// 		'16.04.24',
	// 		'17.04.24',
	// 		'18.04.24',
	// 		'19.04.24',
	// 		'20.04.24',
	// 		'21.04.24',
	// 		'22.04.24',
	// 		'23.04.24',
	// 		'24.04.24',
	// 		'25.04.24',
	// 		'26.04.24',
	// 		'27.04.24',
	// 		'28.04.24',
	// 		'29.04.24',
	// 		'30.04.24',
	// 		'01.05.24',
	// 		'02.05.24',
	// 		'03.05.24',
	// 		'04.05.24',
	// 		'05.05.24',
	// 		'06.05.24',
	// 		'07.05.24',
	// 		'08.05.24',
	// 		'09.05.24',
	// 		'10.05.24',
	// 		'11.05.24',
	// 		'12.05.24',
	// 		'13.05.24',
	// 		'14.05.24',
	// 		'15.05.24',
	// 		'16.05.24',
	// 		'17.05.24',
	// 		'18.05.24',
	// 		'19.05.24',
	// 		'20.05.24',
	// 		'21.05.24',
	// 		'22.05.24',
	// 		'23.05.24',
	// 		'24.05.24',
	// 		'25.05.24',
	// 		'26.05.24',
	// 		'27.05.24',
	// 		'28.05.24',
	// 		'29.05.24',
	// 		'30.05.24',
	// 		'31.05.24',
	// 		'01.06.24',
	// 		'02.06.24',
	// 		'03.06.24',
	// 		'04.06.24',
	// 		'05.06.24',
	// 		'06.06.24',
	// 		'07.06.24',
	// 		'08.06.24',
	// 		'09.06.24',
	// 		'10.06.24',
	// 		'11.06.24',
	// 		'12.06.24',
	// 		'13.06.24',
	// 		'14.06.24',
	// 		'15.06.24',
	// 		'16.06.24',
	// 		'17.06.24',
	// 		'18.06.24',
	// 		'19.06.24',
	// 		'20.06.24',
	// 		'21.06.24',
	// 		'22.06.24',
	// 		'23.06.24',
	// 		'24.06.24',
	// 		'25.06.24',
	// 		'26.06.24',
	// 		'27.06.24',
	// 		'28.06.24',
	// 		'29.06.24',
	// 		'30.06.24',
	// 		'01.07.24',
	// 		'02.07.24',
	// 		'03.07.24',
	// 		'04.07.24',
	// 		'05.07.24',
	// 		'06.07.24',
	// 		'07.07.24',
	// 		'08.07.24',
	// 		'09.07.24',
	// 		'10.07.24',
	// 		'11.07.24',
	// 		'12.07.24',
	// 		'13.07.24',
	// 		'14.07.24',
	// 		'15.07.24',
	// 		'16.07.24',
	// 		'17.07.24',
	// 		'18.07.24',
	// 		'19.07.24',
	// 		'20.07.24',
	// 		'21.07.24',
	// 		'22.07.24',
	// 		'23.07.24',
	// 		'24.07.24',
	// 		'25.07.24',
	// 		'26.07.24',
	// 		'27.07.24',
	// 		'28.07.24',
	// 		'29.07.24',
	// 		'30.07.24',
	// 		'31.07.24',
	// 		'01.08.24',
	// 		'02.08.24',
	// 		'03.08.24',
	// 		'04.08.24',
	// 		'05.08.24',
	// 		'06.08.24',
	// 		'07.08.24',
	// 		'08.08.24',
	// 		'09.08.24',
	// 		'10.08.24',
	// 		'11.08.24',
	// 		'12.08.24',
	// 		'13.08.24',
	// 		'14.08.24',
	// 		'15.08.24',
	// 		'16.08.24',
	// 		'17.08.24',
	// 		'18.08.24',
	// 		'19.08.24',
	// 		'20.08.24',
	// 		'21.08.24',
	// 		'22.08.24',
	// 		'23.08.24',
	// 		'24.08.24',
	// 		'25.08.24',
	// 		'26.08.24',
	// 		'27.08.24',
	// 		'28.08.24',
	// 		'29.08.24',
	// 		'30.08.24',
	// 		'31.08.24',
	// 		'01.09.24',
	// 		'02.09.24',
	// 		'03.09.24',
	// 		'04.09.24',
	// 		'05.09.24',
	// 		'06.09.24',
	// 		'07.09.24',
	// 		'08.09.24',
	// 		'09.09.24',
	// 		'10.09.24',
	// 		'11.09.24',
	// 		'12.09.24',
	// 		'13.09.24',
	// 		'14.09.24',
	// 		'15.09.24',
	// 		'16.09.24',
	// 		'17.09.24',
	// 		'18.09.24',
	// 		'19.09.24',
	// 		'20.09.24',
	// 		'21.09.24',
	// 		'22.09.24',
	// 		'23.09.24',
	// 		'24.09.24',
	// 		'25.09.24',
	// 		'26.09.24',
	// 		'27.09.24',
	// 		'28.09.24',
	// 		'29.09.24',
	// 		'30.09.24',
	// 		'01.10.24',
	// 		'02.10.24',
	// 		'03.10.24',
	// 		'04.10.24',
	// 		'05.10.24',
	// 		'06.10.24',
	// 		'07.10.24',
	// 		'08.10.24',
	// 		'09.10.24',
	// 		'10.10.24',
	// 		'11.10.24',
	// 		'12.10.24',
	// 		'13.10.24',
	// 		'14.10.24',
	// 		'15.10.24',
	// 		'16.10.24',
	// 		'17.10.24',
	// 		'18.10.24',
	// 		'19.10.24',
	// 		'20.10.24',
	// 		'21.10.24',
	// 		'22.10.24',
	// 		'23.10.24',
	// 		'24.10.24',
	// 		'25.10.24',
	// 		'26.10.24',
	// 		'27.10.24',
	// 		'28.10.24',
	// 		'29.10.24',
	// 		'30.10.24',
	// 		'31.10.24',
	// 		'01.11.24',
	// 		'02.11.24',
	// 		'03.11.24',
	// 		'04.11.24',
	// 		'05.11.24',
	// 		'06.11.24',
	// 		'07.11.24',
	// 		'08.11.24',
	// 		'09.11.24',
	// 		'10.11.24',
	// 		'11.11.24',
	// 		'12.11.24',
	// 		'13.11.24',
	// 		'14.11.24',
	// 		'15.11.24',
	// 		'16.11.24',
	// 		'17.11.24',
	// 		'18.11.24',
	// 		'19.11.24',
	// 		'20.11.24',
	// 		'21.11.24',
	// 		'22.11.24',
	// 		'23.11.24',
	// 		'24.11.24',
	// 		'25.11.24',
	// 		'26.11.24',
	// 		'27.11.24',
	// 		'28.11.24',
	// 		'29.11.24',
	// 		'30.11.24',
	// 		'01.12.24',
	// 	],
	// 	[
	// 		0, 5, 7, 10, 13, 12, 12, 16, 15, 27, 32, 26, 24, 10, 5, 4, 6, 4, 4, 6, 6, 7, 10, 10, 11, 10,
	// 		6, 6, 3, 3, 5, 3, 5, 5, 2, 2, 1, 2, 4, 9, 8, 7, 5, 3, 5, 6, 12, 9, 7, 8, 5, 7, 10, 17, 15, 14,
	// 		12, 9, 9, 8, 10, 5, 9, 12, 10, 9, 7, 7, 11, 19, 21, 23, 24, 20, 20, 15, 13, 11, 6, 8, 8, 9,
	// 		10, 14, 10, 10, 12, 8, 15, 15, 13, 13, 11, 14, 18, 27, 29, 27, 23, 15, 11, 7, 9, 10, 10, 16,
	// 		15, 12, 11, 8, 12, 18, 28, 43, 40, 37, 36, 22, 20, 16, 8, 7, 14, 25, 29, 27, 19, 8, 3, 4, 6,
	// 		11, 9, 12, 12, 12, 15, 10, 10, 8, 16, 19, 25, 23, 12, 13, 20, 21, 24, 26, 20, 19, 20, 16, 15,
	// 		17, 18, 19, 37, 45, 53, 50, 34, 24, 15, 22, 27, 28, 30, 24, 18, 41, 44, 34, 34, 42, 39, 39,
	// 		39, 39, 40, 37, 36, 38, 38, 40, 39, 38, 37, 44, 33, 34, 33, 34, 33, 33, 34, 34, 33, 33, 35,
	// 		33, 35, 34, 34, 33, 35, 35, 38, 35, 34, 36, 34, 34, 36, 34, 36, 42, 40, 46, 38, 39, 41, 41,
	// 		39, 42, 38, 38, 39, 40, 41, 38, 48, 41, 39, 40, 45, 45, 47, 42, 49, 52, 46, 45, 49, 47, 44,
	// 		47, 43, 44, 43, 45, 46, 45, 46, 45, 43, 44, 43, 44, 48, 46, 50, 46, 44, 44, 44, 44, 44, 44,
	// 		44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44,
	// 		44, 44, 44, 44, 44, 44, 44, 44,
	// 	],
	// ];

	$: data = {
		datasets: [
			{
				backgroundColor: '#a78bfa',
				borderColor: '#7c3aed',
				borderWidth: 1,
				data: dataset[1],
				fill: true,
				tension: 0.3,
			},
		],
		labels: dataset[0],
	};

	$: options = {
		elements: {
			point: {
				radius: interval === ReportIntervals.DAY ? 0 : 3,
			},
		},
		plugins: {
			legend: {
				display: false,
			},
		},
	};
</script>

<div>
	<div class="flex items-center justify-between">
		<h2 class="text-base font-semibold leading-5 text-gray-600">Tasks by {intervalKey}</h2>
		<Select
			bind:value={interval}
			class="flex w-40 items-center gap-2"
			label="Interval"
			selectClass="grow"
		>
			<span class="lowercase" slot="placeholder">
				{intervalKey}
			</span>
			{#each Object.keys(ReportIntervals) as reportIntervalKey (reportIntervalKey)}
				<SelectItem class="lowercase" value={ReportIntervals[reportIntervalKey]}>
					{reportIntervalKey}
				</SelectItem>
			{/each}
		</Select>
	</div>

	<LineChart {data} {options} />
</div>
